<Window x:Class="Swarm.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Swarm.ViewModels"
        xmlns:views="clr-namespace:Swarm.UI.Views"
        mc:Ignorable="d"
        Title="Swarm" 
        Icon="Assets/swarm.ico"
        Height="720" Width="1180"
        MinHeight="600" MinWidth="900"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterScreen">

    <!-- Keyboard Shortcuts -->
    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding OpenSyncFolderCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding ForceSyncCommand}"/>
        <KeyBinding Key="H" Modifiers="Ctrl" Command="{Binding OpenVersionHistoryCommand}"/>
        <KeyBinding Key="L" Modifiers="Ctrl" Command="{Binding OpenActivityLogCommand}"/>
        <KeyBinding Key="D" Modifiers="Ctrl" Command="{Binding NavigateToOverviewCommand}"/>
        <KeyBinding Key="B" Modifiers="Ctrl" Command="{Binding NavigateToFilesCommand}"/>
        <KeyBinding Key="Comma" Modifiers="Ctrl" Command="{Binding NavigateToSettingsCommand}"/>
        <KeyBinding Key="R" Modifiers="Ctrl+Shift" Command="{Binding ForceSyncCommand}"/>
        <KeyBinding Key="P" Modifiers="Ctrl" Command="{Binding TogglePauseSyncCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <!-- DataTemplates -->
        <DataTemplate DataType="{x:Type vm:OverviewViewModel}">
            <views:OverviewView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:FilesViewModel}">
            <views:FilesView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:PeersViewModel}">
            <views:PeersView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SettingsViewModel}">
            <views:SettingsView/>
        </DataTemplate>

        <!-- Nav Button Style -->
        <Style x:Key="NavButtonStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Margin" Value="0,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal">
                                <ContentPresenter Content="{TemplateBinding Tag}" 
                                                  VerticalAlignment="Center" 
                                                  TextBlock.FontFamily="Segoe UI Emoji, Segoe UI Symbol"/>
                                <TextBlock Text="{TemplateBinding Content}" 
                                           Margin="12,0,0,0" 
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                <Setter TargetName="border" Property="Background" Value="#10ffffff"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                <Setter TargetName="border" Property="Background" Value="#152dd4bf"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- Main Container -->
    <Border Background="{StaticResource BackgroundDarkBrush}" CornerRadius="12" BorderBrush="#30FFFFFF" BorderThickness="1">
        <Grid>
            <!-- Background Elements -->
            <Grid IsHitTestVisible="False">
                <Ellipse Width="600" Height="600" Fill="{StaticResource GlowBrush}" Opacity="0.1" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,-100,-100"/>
                <Ellipse Width="400" Height="400" Fill="{StaticResource GlowBrush}" Opacity="0.05" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-100,-100,0,0"/>
            </Grid>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="240"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- ========== SIDEBAR ========== -->
                <Border Grid.Column="0" Background="#0Cffffff" BorderBrush="#15ffffff" BorderThickness="0,0,1,0" CornerRadius="12,0,0,12" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- Header -->
                            <RowDefinition Height="*"/>    <!-- Nav -->
                            <RowDefinition Height="Auto"/> <!-- Footer -->
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Margin="0,12,0,24">
                            <!-- Logo & Title -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <Ellipse Width="12" Height="12" Fill="{StaticResource AccentPrimaryBrush}"/>
                                <Ellipse Width="12" Height="12" Fill="{StaticResource AccentSecondaryBrush}" Margin="-6,0,0,0" Opacity="0.8"/>
                                <TextBlock Text="SWARM" FontWeight="Bold" FontSize="18" Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                
                                <!-- Syncing Indicator with Animation (clickable to open flyout) -->
                                <Border Visibility="{Binding IsSyncingVisible}" Background="#20ffffff" CornerRadius="10" Padding="6,3" Margin="8,0,0,0" VerticalAlignment="Center"
                                        Cursor="Hand" MouseLeftButtonDown="SyncingIndicator_Click">
                                    <StackPanel Orientation="Horizontal">
                                        <!-- Animated sync icon using Path -->
                                        <Grid Width="12" Height="12" RenderTransformOrigin="0.5,0.5">
                                            <Grid.RenderTransform>
                                                <RotateTransform x:Name="SyncRotate" Angle="0"/>
                                            </Grid.RenderTransform>
                                            <Path Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z" 
                                                  Fill="{StaticResource AccentPrimaryBrush}" Stretch="Uniform"/>
                                            <Grid.Triggers>
                                                <EventTrigger RoutedEvent="Loaded">
                                                    <BeginStoryboard>
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation Storyboard.TargetProperty="(Grid.RenderTransform).(RotateTransform.Angle)"
                                                                           From="0" To="360" Duration="0:0:1.5">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <SineEase EasingMode="EaseInOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Grid.Triggers>
                                        </Grid>
                                        <TextBlock Text="{Binding SyncingFileCountText}" Foreground="{StaticResource AccentPrimaryBrush}" 
                                                   FontSize="10" FontWeight="SemiBold" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                            
                            <!-- Transfer Speed Indicator (clickable to open flyout) -->
                            <TextBlock Text="{Binding TransferSpeedText}" Foreground="{StaticResource TextMutedBrush}" 
                                       FontSize="11" Margin="0,0,0,0" Cursor="Hand" MouseLeftButtonDown="SyncingIndicator_Click"
                                       Visibility="{Binding TransferSpeedText, Converter={StaticResource NullToCollapsedConverter}}"/>
                        </StackPanel>

                        <!-- Navigation -->
                        <StackPanel Grid.Row="1">
                            <RadioButton Content="Overview" Tag="🏠" Command="{Binding NavigateToOverviewCommand}" IsChecked="True" Style="{StaticResource NavButtonStyle}"/>
                            <RadioButton Content="My Files" Tag="📂" Command="{Binding NavigateToFilesCommand}" Style="{StaticResource NavButtonStyle}"/>
                            <RadioButton Content="Peers" Tag="🔌" Command="{Binding NavigateToPeersCommand}" Style="{StaticResource NavButtonStyle}"/>
                            <RadioButton Content="Settings" Tag="⚙️" Command="{Binding NavigateToSettingsCommand}" Style="{StaticResource NavButtonStyle}"/>
                        </StackPanel>

                        <!-- Footer -->
                        <StackPanel Grid.Row="2">
                             <!-- Version Info -->
                             <TextBlock Text="v0.4.0-beta" Foreground="{StaticResource TextMutedBrush}" FontSize="11" Margin="16,0,0,4"/>
                             
                             <!-- Status Indicator -->
                             <Border Background="#10ffffff" CornerRadius="8" Padding="12,8" Margin="0,12,0,0">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="Auto"/>
                                         <ColumnDefinition Width="*"/>
                                     </Grid.ColumnDefinitions>
                                     
                                     <Ellipse Width="8" Height="8" Fill="{StaticResource StatusOnlineBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                     <TextBlock Grid.Column="1" Text="{Binding StatusText}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" TextTrimming="CharacterEllipsis"/>
                                 </Grid>
                             </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- ========== MAIN CONTENT AREA ========== -->
                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="50"/> <!-- Title Bar (Window Controls) -->
                        <RowDefinition Height="*"/>    <!-- View Content -->
                    </Grid.RowDefinitions>

                    <!-- Custom Title Bar (Drag Area + Window Controls) -->
                    <Grid Grid.Row="0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown" Background="Transparent">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,16,0" VerticalAlignment="Center">
                             <Button Style="{StaticResource IconButtonStyle}" Click="MinimizeButton_Click" ToolTip="Minimize">
                                <Path Data="M20 14H4v-2h16" Width="10" Height="10" Stretch="Uniform" Fill="{StaticResource TextSecondaryBrush}"/>
                            </Button>
                            <Button Style="{StaticResource IconButtonStyle}" Click="MaximizeButton_Click" ToolTip="Maximize">
                                <Path Data="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z" Width="10" Height="10" Stretch="Uniform" Fill="{StaticResource TextSecondaryBrush}"/>
                            </Button>
                            <Button Style="{StaticResource IconButtonStyle}" Click="CloseButton_Click" ToolTip="Close">
                                <Path Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" Width="10" Height="10" Stretch="Uniform" Fill="{StaticResource AccentDestructiveBrush}"/>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- View Content -->
                    <ContentControl Grid.Row="1" Content="{Binding CurrentView}" Margin="0,0,0,0"/>

                    <!-- Notification Stack (Toast) -->
                    <StackPanel x:Name="NotificationStack" Grid.Row="1" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,24,24" Width="300"/>
                </Grid>
            </Grid>

            <!-- ========== MODAL OVERLAYS ========== -->
            <Grid x:Name="ModalOverlay" Visibility="Collapsed" Background="#aa000000">
                <!-- Trust Device Dialog -->
                <Border x:Name="TrustDeviceDialog" Visibility="Collapsed" 
                        Background="{StaticResource BackgroundCardBrush}" Width="400" CornerRadius="12" Padding="24" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel>
                        <TextBlock Text="New Device Discovered" FontWeight="Bold" FontSize="18" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,12"/>
                        <TextBlock Text="A new device wants to join your swarm. Do you trust this device?" TextWrapping="Wrap" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,20"/>

                        <Border Background="#10ffffff" CornerRadius="8" Padding="12" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock x:Name="TrustDeviceName" Text="Unknown Device" FontWeight="Bold" Foreground="{StaticResource AccentPrimaryBrush}" FontSize="16"/>
                                <Grid Margin="0,8,0,0" ToolTip="Click to copy" MouseLeftButtonUp="DeviceFingerprint_Click" Cursor="Hand" Background="Transparent">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Fingerprint:" Foreground="{StaticResource TextMutedBrush}" FontSize="11"/>
                                    <TextBlock x:Name="DeviceFingerprint" Grid.Column="1" Text="XXXX-XXXX" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" FontFamily="Consolas" Margin="8,0,0,0" TextTrimming="CharacterEllipsis"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <Grid Margin="0,0,0,20" ToolTip="Click to copy your fingerprint" MouseLeftButtonUp="MyFingerprint_Click" Cursor="Hand" Background="Transparent">
                             <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                 <TextBlock Text="Compare with your fingerprint: " Foreground="{StaticResource TextMutedBrush}" FontSize="11"/>
                                 <TextBlock x:Name="MyFingerprint" Text="YYYY-YYYY" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" FontFamily="Consolas" FontWeight="Bold"/>
                             </StackPanel>
                        </Grid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                            <Button Content="Ignore" Click="RejectTrust_Click" Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"/>
                            <Button Content="Trust Device" Click="AcceptTrust_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Incoming File Dialog -->
                <Border x:Name="IncomingFileDialog" Visibility="Collapsed" 
                        Background="{StaticResource BackgroundCardBrush}" Width="400" CornerRadius="12" Padding="24" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel>
                        <TextBlock Text="Incoming File Request" FontWeight="Bold" FontSize="18" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,12"/>
                        
                        <Border Background="#10ffffff" CornerRadius="8" Padding="16" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="M13 9V3.5L18.5 9M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6H6z" Fill="{StaticResource AccentPrimaryBrush}" Width="32" Height="32" Stretch="Uniform" Margin="0,0,16,0"/>
                                <StackPanel Grid.Column="1">
                                    <TextBlock x:Name="IncomingFileName" Text="example.pdf" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" TextTrimming="CharacterEllipsis"/>
                                    <TextBlock x:Name="IncomingFileSize" Text="2.4 MB" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" Margin="0,2,0,0"/>
                                    <TextBlock x:Name="IncomingSender" Text="from User" Foreground="{StaticResource TextMutedBrush}" FontSize="12" Margin="0,4,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                             <Button Content="Decline" Click="RejectFile_Click" Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"/>
                             <Button Content="Accept" Click="AcceptFile_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
            
            <!-- Activity Flyout Overlay -->
            <Grid x:Name="ActivityFlyoutOverlay" Visibility="{Binding IsActivityFlyoutOpen, Converter={StaticResource BoolToVisibilityConverter}}" 
                  Background="#80000000" MouseLeftButtonDown="ActivityFlyout_BackgroundClick">
                <Border Background="{StaticResource BackgroundDarkBrush}" CornerRadius="12" 
                        HorizontalAlignment="Right" VerticalAlignment="Stretch" Width="400" Margin="0"
                        BorderBrush="#30FFFFFF" BorderThickness="1,0,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Flyout Header -->
                        <Border Grid.Row="0" Background="#10ffffff" Padding="20,16" BorderBrush="#15ffffff" BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Sync Activity" FontWeight="Bold" FontSize="18" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="{Binding TransferSpeedText}" Foreground="{StaticResource AccentPrimaryBrush}" FontSize="13" Margin="0,4,0,0"/>
                                </StackPanel>
                                <Button Grid.Column="1" Content="✕" Command="{Binding ToggleActivityFlyoutCommand}" 
                                        Background="Transparent" Foreground="{StaticResource TextMutedBrush}" 
                                        FontSize="18" BorderThickness="0" Padding="8" Cursor="Hand"
                                        VerticalAlignment="Top"/>
                            </Grid>
                        </Border>
                        
                        <!-- Active Transfers -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="16">
                            <StackPanel>
                                <!-- Status Summary -->
                                <Border Background="#15ffffff" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding SyncingFileCount}" FontSize="18" FontWeight="Bold" 
                                                       Foreground="{StaticResource AccentPrimaryBrush}" HorizontalAlignment="Center"/>
                                            <TextBlock Text="Active" Foreground="{StaticResource TextMutedBrush}" FontSize="11" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding UploadSpeedText}" FontSize="14" FontWeight="SemiBold" 
                                                       Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                                            <TextBlock Text="Upload" Foreground="{StaticResource TextMutedBrush}" FontSize="11" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DownloadSpeedText}" FontSize="14" FontWeight="SemiBold" 
                                                       Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                                            <TextBlock Text="Download" Foreground="{StaticResource TextMutedBrush}" FontSize="11" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                
                                <TextBlock Text="ACTIVE TRANSFERS" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="12" Margin="0,0,0,8"/>
                                
                                <!-- Transfer List -->
                                <ItemsControl ItemsSource="{Binding Transfers}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#10ffffff" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <!-- Direction Icon -->
                                                    <TextBlock FontSize="16" VerticalAlignment="Center" Margin="0,0,12,0">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Text" Value="📤"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Direction}" Value="Incoming">
                                                                        <Setter Property="Text" Value="📥"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                    
                                                    <!-- File Info -->
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding FileName}" Foreground="{StaticResource TextPrimaryBrush}" 
                                                                   FontWeight="Medium" TextTrimming="CharacterEllipsis"/>
                                                        <ProgressBar Value="{Binding Progress}" Maximum="100" Height="4" 
                                                                     Margin="0,6,0,0" Background="#20ffffff" 
                                                                     Foreground="{StaticResource AccentPrimaryBrush}"/>
                                                    </StackPanel>
                                                    
                                                    <!-- Speed -->
                                                    <TextBlock Grid.Column="2" Text="{Binding SpeedDisplay}" 
                                                               Foreground="{StaticResource TextMutedBrush}" 
                                                               FontSize="11" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                
                                <!-- Empty State -->
                                <TextBlock Text="No active transfers" Foreground="{StaticResource TextMutedBrush}" 
                                           FontSize="13" HorizontalAlignment="Center" Margin="0,32,0,0"
                                           Visibility="{Binding EmptyTransfersVisibility}"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
