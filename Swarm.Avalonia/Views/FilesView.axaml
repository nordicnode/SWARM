<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Swarm.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Swarm.Avalonia.Views.FilesView"
             x:DataType="vm:FilesViewModel">

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,24">
            <TextBlock Text="My Files"
                       FontSize="28"
                       FontWeight="SemiBold"
                       Foreground="{StaticResource TextPrimaryBrush}"/>
            
            <!-- Search Box -->
            <Border Grid.Column="1" 
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    Padding="12,8"
                    BorderBrush="{StaticResource BorderLightBrush}"
                    BorderThickness="1"
                    MinWidth="250">
                <Grid ColumnDefinitions="Auto,*">
                    <PathIcon Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                              Width="14" Height="14"
                              Foreground="{StaticResource TextMutedBrush}"
                              Margin="0,0,8,0"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding SearchFilter, Mode=TwoWay}"
                             Watermark="Search files..."
                             BorderThickness="0"
                             Background="Transparent"
                             Padding="0"
                             FontSize="13"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Breadcrumb / Path -->
        <Border Grid.Row="1"
                Background="{StaticResource SurfaceBrush}"
                CornerRadius="8"
                Padding="16,12"
                Margin="0,0,0,16"
                BorderBrush="{StaticResource BorderLightBrush}"
                BorderThickness="1">
            <Grid ColumnDefinitions="Auto,*">
                <Button Grid.Column="0"
                        Command="{Binding NavigateUpCommand}"
                        Classes="icon"
                        Margin="0,0,12,0"
                        ToolTip.Tip="Go Up">
                    <PathIcon Data="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
                              Width="16" Height="16"
                              Foreground="{StaticResource TextSecondaryBrush}"/>
                </Button>
                <ScrollViewer Grid.Column="1" 
                              HorizontalScrollBarVisibility="Hidden" 
                              VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding PathSegments}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="4"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <Button Classes="Link" 
                                            Content="{Binding Name}"
                                            Command="{Binding $parent[UserControl].((vm:FilesViewModel)DataContext).NavigateToPathCommand}"
                                            CommandParameter="{Binding Path}"
                                            Foreground="{DynamicResource TextPrimaryBrush}"
                                            FontSize="13"
                                            FontWeight="Medium"/>
                                    <TextBlock Text="â€º" 
                                               FontSize="14"
                                               Foreground="{DynamicResource TextTertiaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="2,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- File List Table -->
        <Border Grid.Row="2" 
                Background="{StaticResource SurfaceBrush}" 
                CornerRadius="8"
                BorderBrush="{StaticResource BorderLightBrush}"
                BorderThickness="1"
                ClipToBounds="True">
            <Grid>
                <DataGrid Name="FilesGrid"
                          ItemsSource="{Binding Files}"
                          SelectedItem="{Binding SelectedFile}"
                          AutoGenerateColumns="False"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="#15ffffff"
                          BorderThickness="0"
                          Background="Transparent"
                          IsReadOnly="True">

                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Open" Command="{Binding OpenCommand}"/>
                            <MenuItem Header="Show in Explorer" Command="{Binding ShowInExplorerCommand}"/>
                            <Separator/>
                            <MenuItem Header="Delete" Command="{Binding DeleteCommand}" Foreground="{StaticResource AccentDestructiveBrush}"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <DataGrid.Styles>
                        <Style Selector="DataGridColumnHeader">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="FontSize" Value="11"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="Padding" Value="16,14,16,14"/>
                            <Setter Property="MinHeight" Value="44"/>
                            <Setter Property="BorderThickness" Value="0,0,0,2"/>
                            <Setter Property="BorderBrush" Value="#25ffffff"/>
                        </Style>
                        <Style Selector="DataGridRow">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="MinHeight" Value="56"/>
                        </Style>
                        <Style Selector="DataGridRow:pointerover /template/ Rectangle#BackgroundRectangle">
                            <Setter Property="Fill" Value="#08ffffff"/>
                            <Setter Property="Opacity" Value="1"/>
                        </Style>
                        <Style Selector="DataGridRow:selected /template/ Rectangle#BackgroundRectangle">
                            <Setter Property="Fill" Value="{DynamicResource AccentPrimaryBrush}"/>
                            <Setter Property="Opacity" Value="0.08"/>
                        </Style>
                        <Style Selector="DataGridCell">
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="FontSize" Value="13"/>
                            <Setter Property="BorderThickness" Value="0"/>
                        </Style>
                    </DataGrid.Styles>

                    <DataGrid.Columns>
                        <!-- Extension Badge Column -->
                        <DataGridTemplateColumn Header="TYPE" Width="90" CanUserSort="False" CanUserResize="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:FileItemViewModel">
                                    <Border Background="{DynamicResource BackgroundLightBrush}"
                                            BorderBrush="{DynamicResource AccentPrimaryBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Padding="10,5"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            MinWidth="48">
                                        <TextBlock Text="{Binding Extension}"
                                                   FontSize="10"
                                                   FontWeight="Black"
                                                   Foreground="{DynamicResource AccentPrimaryBrush}"
                                                   HorizontalAlignment="Center"
                                                   LetterSpacing="0.5"
                                                   TextAlignment="Center"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Name Column -->
                        <DataGridTemplateColumn Header="NAME" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:FileItemViewModel">
                                    <TextBlock Text="{Binding Name}" 
                                               VerticalAlignment="Center" 
                                               Padding="16,0"
                                               FontSize="13"
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip.Tip="{Binding Name}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Size Column -->
                        <DataGridTemplateColumn Header="SIZE" Width="110">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:FileItemViewModel">
                                    <TextBlock Text="{Binding Size}" 
                                               VerticalAlignment="Center"
                                               Padding="16,0"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               FontSize="12"
                                               FontWeight="Medium"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Date Modified Column -->
                        <DataGridTemplateColumn Header="MODIFIED" Width="180">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:FileItemViewModel">
                                    <TextBlock Text="{Binding Modified}" 
                                               VerticalAlignment="Center"
                                               Padding="16,0"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               FontSize="12"
                                               FontWeight="Medium"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Empty State -->
                <StackPanel HorizontalAlignment="Center" 
                            VerticalAlignment="Center" 
                            Spacing="16"
                            IsVisible="{Binding IsEmpty}">
                    <Border Background="{DynamicResource BackgroundLightBrush}"
                            BorderBrush="{DynamicResource AccentPrimaryBrush}"
                            BorderThickness="2"
                            CornerRadius="16"
                            Width="96" Height="96"
                            HorizontalAlignment="Center">
                        <PathIcon Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" 
                                  Width="40" Height="40" 
                                  Foreground="{DynamicResource AccentPrimaryBrush}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="This folder is empty"
                               FontSize="16"
                               FontWeight="SemiBold"
                               TextAlignment="Center"
                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                    <TextBlock Text="Files added here will be synced automatically"
                               FontSize="13"
                               TextAlignment="Center"
                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
