<UserControl x:Class="Swarm.UI.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="800">
    
    <Grid Cursor="Arrow">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ========== SETTINGS TABS ========== -->
        <TabControl Grid.Row="0" Style="{StaticResource SettingsTabControlStyle}" Margin="0,12,0,0">
            
            <!-- ===== GENERAL TAB ===== -->
            <TabItem Header="General" Style="{StaticResource SettingsTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="24,24,24,24" MaxWidth="800">
                        
                        <!-- Device Identity Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Device Identity" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <TextBlock Text="Device Name" Style="{StaticResource SettingsLabelStyle}"/>
                                <TextBlock Text="How this device appears to others on the network" 
                                           Style="{StaticResource SettingsDescriptionStyle}" Margin="0,0,0,8"/>
                                <TextBox x:Name="DeviceNameTextBox" 
                                         Style="{StaticResource SettingsTextBoxStyle}"
                                         MaxWidth="400" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </Border>

                        <!-- Notifications Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Notifications" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Show Notifications" Style="{StaticResource SettingsLabelStyle}"/>
                                        <TextBlock Text="Display alerts for incoming files and events" Style="{StaticResource SettingsDescriptionStyle}"/>
                                    </StackPanel>
                                    <CheckBox x:Name="NotificationsToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                                </Grid>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Transfer Completion Alerts" Style="{StaticResource SettingsLabelStyle}"/>
                                        <TextBlock Text="Notify when file transfers complete" Style="{StaticResource SettingsDescriptionStyle}"/>
                                    </StackPanel>
                                    <CheckBox x:Name="ShowCompleteToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Startup Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Start Minimized" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock Text="Launch application minimized to system tray" Style="{StaticResource SettingsDescriptionStyle}"/>
                                </StackPanel>
                                <CheckBox x:Name="StartMinimizedToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- About Card -->
                        <Border Background="#10FFFFFF" CornerRadius="12" Padding="24">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- App Icon placeholder -->
                                <Border Width="56" Height="56" CornerRadius="12" Background="{StaticResource AccentPrimaryBrush}" Margin="0,0,20,0">
                                    <TextBlock Text="S" FontSize="28" FontWeight="Bold" Foreground="White" 
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Swarm" FontWeight="Bold" FontSize="18" Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock x:Name="VersionText" Text=" v1.0.0" FontSize="18" Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                    <TextBlock Text="Fast, secure LAN file sharing and synchronization" 
                                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="13" Margin="0,4,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Sync" Style="{StaticResource SettingsTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="24,24,24,24" MaxWidth="800">
                        
                        <!-- Sync Enable Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Enable Folder Sync" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock Text="Automatically synchronize files with connected peers" Style="{StaticResource SettingsDescriptionStyle}"/>
                                </StackPanel>
                                <CheckBox x:Name="SyncEnabledToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Sync Location Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Sync Location" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <TextBlock Text="Sync Folder" Style="{StaticResource SettingsLabelStyle}"/>
                                <TextBlock Text="Primary folder for file synchronization" Style="{StaticResource SettingsDescriptionStyle}" Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Background="#10FFFFFF" CornerRadius="8" Padding="12,10">
                                        <TextBlock x:Name="SyncFolderPathText" Text="Documents\SWARM\Synced" 
                                                   Foreground="{StaticResource TextSecondaryBrush}" TextTrimming="CharacterEllipsis"/>
                                    </Border>
                                    <Button Grid.Column="1" Content="Browse" Style="{StaticResource SecondaryButtonStyle}" 
                                            Padding="16,10" Margin="12,0,0,0" Click="BrowseSyncFolder_Click"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Selective Sync Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Selective Sync" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                <TextBlock Text="Folders to exclude from synchronization" Style="{StaticResource SettingsDescriptionStyle}" Margin="0,0,0,12"/>
                                
                                <Border Background="#10FFFFFF" CornerRadius="8" Padding="12" MinHeight="80">
                                    <Grid>
                                        <ListBox x:Name="ExcludedFoldersListBox" Background="Transparent" BorderThickness="0" MaxHeight="120" ItemContainerStyle="{StaticResource PeerListBoxItemStyle}">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Path Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" Width="14" Height="14" Stretch="Uniform" Fill="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding}" Foreground="{StaticResource TextPrimaryBrush}" TextTrimming="CharacterEllipsis"/>
                                                        <Button Grid.Column="2" Content="âœ•" Foreground="#F85149" Background="Transparent" BorderThickness="0" Click="RemoveExcludedFolder_Click"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                        <TextBlock x:Name="NoExcludedFoldersText" Text="No excluded folders" Foreground="{StaticResource TextMutedBrush}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                                <Button Content="+ Add Folder" Style="{StaticResource SecondaryButtonStyle}" HorizontalAlignment="Left" Margin="0,12,0,0" Click="AddExcludedFolder_Click"/>
                            </StackPanel>
                        </Border>

                        <!-- Conflict Resolution Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Conflict Resolution" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                <TextBlock Text="How to handle files modified on multiple devices" Style="{StaticResource SettingsDescriptionStyle}" Margin="0,0,0,12"/>
                                <ComboBox x:Name="ConflictResolutionComboBox" Style="{StaticResource SettingsComboBoxStyle}" MaxWidth="300" HorizontalAlignment="Left">
                                    <ComboBoxItem Content="Newest Wins (auto)" Tag="AutoNewest"/>
                                    <ComboBoxItem Content="Keep Both Files" Tag="KeepBoth"/>
                                    <ComboBoxItem Content="Ask Me Each Time" Tag="AskUser"/>
                                    <ComboBoxItem Content="Always Keep Local" Tag="AlwaysKeepLocal"/>
                                    <ComboBoxItem Content="Always Accept Remote" Tag="AlwaysKeepRemote"/>
                                </ComboBox>
                            </StackPanel>
                        </Border>

                        <!-- Rescan Settings Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24">
                            <StackPanel>
                                <TextBlock Text="Rescan Settings" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,8">
                                    <TextBlock Text="Rescan Interval" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock x:Name="RescanIntervalValueText" Text="30 min" Style="{StaticResource SettingsLabelStyle}" HorizontalAlignment="Right" Foreground="{StaticResource AccentPrimaryBrush}"/>
                                </Grid>
                                <Slider x:Name="RescanIntervalSlider" Minimum="0" Maximum="120" Value="30" TickFrequency="5" IsSnapToTickEnabled="True" ValueChanged="RescanIntervalSlider_ValueChanged" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Deep Rescan (Hash Verification)" Style="{StaticResource SettingsLabelStyle}"/>
                                        <TextBlock Text="Slower but verifies file content integrity" Style="{StaticResource SettingsDescriptionStyle}"/>
                                    </StackPanel>
                                    <CheckBox x:Name="DeepRescanToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                                </Grid>
                                
                                <Button x:Name="RescanNowButton" Content="ðŸ”„ Run Manual Rescan" Style="{StaticResource SecondaryButtonStyle}" 
                                        HorizontalAlignment="Left" Padding="16,10" Click="RescanNow_Click"/>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ===== TRANSFERS TAB ===== -->
            <TabItem Header="Transfers" Style="{StaticResource SettingsTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="24,24,24,24" MaxWidth="800">
                        
                        <!-- Download Location Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Download Location" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                <TextBlock Text="Where received files are saved" Style="{StaticResource SettingsDescriptionStyle}" Margin="0,0,0,12"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Background="#10FFFFFF" CornerRadius="8" Padding="12,10">
                                        <TextBlock x:Name="DownloadPathText" Text="Downloads\Swarm" 
                                                   Foreground="{StaticResource TextSecondaryBrush}" TextTrimming="CharacterEllipsis"/>
                                    </Border>
                                    <Button Grid.Column="1" Content="Browse" Style="{StaticResource SecondaryButtonStyle}" 
                                            Padding="16,10" Margin="12,0,0,0" Click="BrowseDownloadPath_Click"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Auto Accept Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Auto-Accept from Trusted Peers" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock Text="Automatically accept files from trusted devices" Style="{StaticResource SettingsDescriptionStyle}"/>
                                </StackPanel>
                                <CheckBox x:Name="AutoAcceptToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Bandwidth Limits Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24">
                            <StackPanel>
                                <TextBlock Text="Bandwidth Limits" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,8">
                                    <TextBlock Text="Max Download Speed" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock x:Name="MaxDownloadSpeedValueText" Text="Unlimited" Style="{StaticResource SettingsLabelStyle}" HorizontalAlignment="Right" Foreground="{StaticResource AccentPrimaryBrush}"/>
                                </Grid>
                                <Slider x:Name="MaxDownloadSpeedSlider" Minimum="0" Maximum="102400" Value="0" TickFrequency="256" IsSnapToTickEnabled="True" ValueChanged="MaxDownloadSpeedSlider_ValueChanged" Margin="0,0,0,20"/>

                                <Grid Margin="0,0,0,8">
                                    <TextBlock Text="Max Upload Speed" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock x:Name="MaxUploadSpeedValueText" Text="Unlimited" Style="{StaticResource SettingsLabelStyle}" HorizontalAlignment="Right" Foreground="{StaticResource AccentPrimaryBrush}"/>
                                </Grid>
                                <Slider x:Name="MaxUploadSpeedSlider" Minimum="0" Maximum="102400" Value="0" TickFrequency="256" IsSnapToTickEnabled="True" ValueChanged="MaxUploadSpeedSlider_ValueChanged"/>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ===== VERSIONING TAB ===== -->
            <TabItem Header="Versioning" Style="{StaticResource SettingsTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="24,24,24,24" MaxWidth="800">
                        
                        <!-- Versioning Toggle Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Enable File Versioning" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock Text="Keep backup copies of overwritten files" Style="{StaticResource SettingsDescriptionStyle}"/>
                                </StackPanel>
                                <CheckBox x:Name="VersioningEnabledToggle" Grid.Column="1" Style="{StaticResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Version Settings Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Version Retention" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,8">
                                    <TextBlock Text="Max Versions Per File" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock x:Name="MaxVersionsValueText" Text="10" Style="{StaticResource SettingsLabelStyle}" HorizontalAlignment="Right" Foreground="{StaticResource AccentPrimaryBrush}"/>
                                </Grid>
                                <Slider x:Name="MaxVersionsSlider" Minimum="1" Maximum="50" ValueChanged="MaxVersionsSlider_ValueChanged" Margin="0,0,0,20"/>

                                <Grid Margin="0,0,0,8">
                                    <TextBlock Text="Retention Period" Style="{StaticResource SettingsLabelStyle}"/>
                                    <TextBlock x:Name="MaxAgeValueText" Text="30 days" Style="{StaticResource SettingsLabelStyle}" HorizontalAlignment="Right" Foreground="{StaticResource AccentPrimaryBrush}"/>
                                </Grid>
                                <Slider x:Name="MaxAgeSlider" Minimum="0" Maximum="365" ValueChanged="MaxAgeSlider_ValueChanged"/>
                            </StackPanel>
                        </Border>

                        <!-- Version Storage Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24">
                            <StackPanel>
                                <TextBlock Text="Version Storage" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Total Version Storage" Style="{StaticResource SettingsLabelStyle}"/>
                                        <TextBlock x:Name="VersionStorageSizeText" Text="Calculating..." 
                                                   Foreground="{StaticResource AccentPrimaryBrush}" FontWeight="Medium" FontSize="18" Margin="0,4,0,0"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock x:Name="VersionCountText" Text="0 versions" 
                                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="13" HorizontalAlignment="Right"/>
                                    </StackPanel>
                                </Grid>
                                
                                <Button x:Name="ClearAllVersionsButton" Content="ðŸ—‘ï¸ Clear All Versions" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Padding="16,10" HorizontalAlignment="Left"
                                        Click="ClearAllVersions_Click"/>
                                <TextBlock Text="This action cannot be undone." 
                                           Style="{StaticResource SettingsDescriptionStyle}" Margin="0,8,0,0" Foreground="#F85149"/>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ===== PEERS TAB ===== -->
            <TabItem Header="Peers" Style="{StaticResource SettingsTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="24,24,24,24" MaxWidth="800">
                        
                        <!-- Trusted Peers Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24">
                            <StackPanel>
                                <TextBlock Text="Trusted Peers" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                <TextBlock Text="Devices authorized for automatic file acceptance" Style="{StaticResource SettingsDescriptionStyle}" Margin="0,0,0,16"/>
                                
                                <Border Background="#10FFFFFF" CornerRadius="8" Padding="12" MinHeight="150">
                                    <Grid>
                                        <ListBox x:Name="TrustedPeersListBox" Background="Transparent" BorderThickness="0" ItemContainerStyle="{StaticResource PeerListBoxItemStyle}">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="0,4">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="Medium"/>
                                                            <TextBlock Text="{Binding Id}" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        </StackPanel>
                                                        <Button Grid.Column="1" Content="Remove" Foreground="#F85149" Background="Transparent" BorderThickness="0" Click="RemoveTrustedPeer_Click" Cursor="Hand"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                        <TextBlock x:Name="NoTrustedPeersText" Text="No trusted peers configured" Foreground="{StaticResource TextMutedBrush}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                                
                                <TextBlock Text="To add a trusted peer, accept an incoming file from them and check 'Trust this device'" 
                                           Style="{StaticResource SettingsDescriptionStyle}" Margin="0,12,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ===== MAINTENANCE TAB ===== -->
            <TabItem Header="Maintenance" Style="{StaticResource SettingsTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="24,24,24,24" MaxWidth="800">
                        
                        <!-- System Health Card -->
                        <Border Background="#08FFFFFF" CornerRadius="12" Padding="24">
                            <StackPanel>
                                <TextBlock Text="System Health &amp; Diagnostics" FontSize="16" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,16"/>
                                
                                <Button Content="ðŸ“‹ View Activity Log" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Padding="20,14" Margin="0,0,0,12"
                                        HorizontalAlignment="Stretch"
                                        Click="ViewActivityLog_Click"/>
                                
                                <Button x:Name="VerifyIntegrityButton" 
                                        Content="ðŸ” Verify File Integrity" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Padding="20,14"
                                        HorizontalAlignment="Stretch"
                                        Click="VerifyIntegrity_Click"/>
                                        
                                <TextBlock Text="Run integrity check to scan for corrupted or missing files in your sync folder." 
                                           Style="{StaticResource SettingsDescriptionStyle}"
                                           Margin="0,16,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- ========== FOOTER BUTTONS ========== -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundMediumBrush}" 
                CornerRadius="0,0,12,12" Padding="24,16">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Discard Changes" 
                        Style="{StaticResource SecondaryButtonStyle}"
                        Padding="24,10"
                        Click="CancelButton_Click"/>
                <Button Content="Save Settings" 
                        Style="{StaticResource PrimaryButtonStyle}"
                        Padding="24,10" Margin="12,0,0,0"
                        Click="SaveButton_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
