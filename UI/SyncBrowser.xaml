<Window x:Class="Swarm.UI.SyncBrowser"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Sync Folder Browser" 
        Height="600" Width="800"
        MinHeight="400" MinWidth="600"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    
    <Border Background="{StaticResource BackgroundDarkBrush}" 
            CornerRadius="12" 
            BorderBrush="#30FFFFFF" 
            BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ========== TITLE BAR ========== -->
            <Border Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" 
                    CornerRadius="12,12,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                        <!-- Folder Icon -->
                        <Path Data="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" 
                              Width="18" Height="18" Stretch="Uniform" 
                              Fill="{StaticResource AccentPrimaryBrush}" VerticalAlignment="Center"/>
                        <TextBlock Text="Sync Folder Browser" FontWeight="Bold" FontSize="16" 
                                   Foreground="{StaticResource TextPrimaryBrush}" 
                                   VerticalAlignment="Center" Margin="12,0,0,0"/>
                    </StackPanel>

                    <!-- Close Button -->
                    <Button Content="âœ•" Width="40" Height="32" 
                            HorizontalAlignment="Right" Margin="0,0,8,0"
                            Foreground="#F85149"
                            Background="Transparent" BorderThickness="0"
                            Padding="0" Cursor="Hand"
                            Click="CloseButton_Click"
                            AutomationProperties.Name="Close Browser"/>
                </Grid>
            </Border>

            <!-- ========== SEARCH BAR ========== -->
            <Border Grid.Row="1" Background="#08ffffff" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Search Box -->
                    <Border Background="#15ffffff" CornerRadius="8" Padding="12,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Search Icon -->
                            <Path Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" 
                                  Width="16" Height="16" Stretch="Uniform" 
                                  Fill="{StaticResource TextMutedBrush}" 
                                  VerticalAlignment="Center" Margin="0,0,8,0"/>
                            
                            <TextBox x:Name="SearchBox" Grid.Column="1"
                                     Background="Transparent" BorderThickness="0"
                                     Foreground="{StaticResource TextPrimaryBrush}"
                                     CaretBrush="{StaticResource TextPrimaryBrush}"
                                     FontSize="14"
                                     Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                     TextChanged="SearchBox_TextChanged"
                                     AutomationProperties.Name="Search files"/>
                            
                            <!-- Clear Button -->
                            <Button x:Name="ClearSearchButton" Grid.Column="2" 
                                    Content="âœ•" FontSize="10"
                                    Background="Transparent" BorderThickness="0"
                                    Foreground="{StaticResource TextMutedBrush}"
                                    Visibility="Collapsed" Cursor="Hand"
                                    Click="ClearSearch_Click" Padding="4"/>
                        </Grid>
                    </Border>
                    
                    <!-- Filter Dropdown -->
                    <ComboBox x:Name="FilterCombo" Grid.Column="1" Margin="12,0,0,0"
                              Background="#15ffffff" BorderThickness="0"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              Padding="12,8" MinWidth="120"
                              SelectionChanged="FilterCombo_SelectionChanged">
                        <ComboBoxItem Content="All Files" IsSelected="True"/>
                        <ComboBoxItem Content="Documents"/>
                        <ComboBoxItem Content="Images"/>
                        <ComboBoxItem Content="Videos"/>
                        <ComboBoxItem Content="Audio"/>
                        <ComboBoxItem Content="Archives"/>
                        <ComboBoxItem Content="Other"/>
                    </ComboBox>
                    
                    <!-- Sort Button -->
                    <Button Grid.Column="2" Margin="8,0,0,0" Padding="12,8"
                            Background="#15ffffff" BorderThickness="0"
                            Foreground="{StaticResource TextSecondaryBrush}"
                            Click="SortButton_Click" Cursor="Hand"
                            ToolTip="Sort files">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z" 
                                  Width="16" Height="16" Stretch="Uniform" 
                                  Fill="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock x:Name="SortText" Text="Name â†‘" Margin="6,0,0,0"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- ========== FILE LIST ========== -->
            <Border Grid.Row="2" Padding="16,8">
                <Grid>
                    <!-- Breadcrumb Navigation -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,8">
                        <Button x:Name="BackButton" Content="â†" Padding="8,4"
                                Background="#15ffffff" BorderThickness="0"
                                Foreground="{StaticResource TextSecondaryBrush}"
                                Click="BackButton_Click" Cursor="Hand"
                                IsEnabled="False" Margin="0,0,8,0"/>
                        <TextBlock x:Name="CurrentPathText" 
                                   Text="/" 
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontSize="13" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <ListView x:Name="FileListView" 
                              Background="Transparent" BorderThickness="0"
                              Margin="0,32,0,0"
                              SelectionMode="Extended"
                              MouseDoubleClick="FileListView_MouseDoubleClick"
                              ItemContainerStyle="{StaticResource PeerListBoxItemStyle}">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="4,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="32"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="120"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- File Icon -->
                                    <Ellipse Width="28" Height="28" VerticalAlignment="Center">
                                        <Ellipse.Fill>
                                            <SolidColorBrush Color="{Binding IconColor}"/>
                                        </Ellipse.Fill>
                                    </Ellipse>
                                    <TextBlock Text="{Binding IconText}" 
                                               Foreground="White" FontSize="11" FontWeight="Bold"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    
                                    <!-- File Name -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0">
                                        <TextBlock Text="{Binding Name}" 
                                                   Foreground="{StaticResource TextPrimaryBrush}" 
                                                   FontSize="14"
                                                   TextTrimming="CharacterEllipsis"
                                                   ToolTip="{Binding FullPath}"/>
                                        <TextBlock Text="{Binding RelativePath}" 
                                                   Foreground="{StaticResource TextMutedBrush}" 
                                                   FontSize="11"
                                                   TextTrimming="CharacterEllipsis"
                                                   Visibility="{Binding ShowPath}"/>
                                    </StackPanel>
                                    
                                    <!-- Size -->
                                    <TextBlock Grid.Column="2" Text="{Binding SizeDisplay}" 
                                               Foreground="{StaticResource TextSecondaryBrush}" 
                                               FontSize="12" VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>
                                    
                                    <!-- Modified Date -->
                                    <TextBlock Grid.Column="3" Text="{Binding ModifiedDisplay}" 
                                               Foreground="{StaticResource TextMutedBrush}" 
                                               FontSize="11" VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    
                    <!-- Empty State -->
                    <StackPanel x:Name="EmptyState" 
                                HorizontalAlignment="Center" VerticalAlignment="Center"
                                Visibility="Collapsed">
                        <TextBlock Text="ðŸ“‚" FontSize="48" HorizontalAlignment="Center"/>
                        <TextBlock Text="No files found" 
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontSize="16" HorizontalAlignment="Center" Margin="0,12,0,0"/>
                        <TextBlock x:Name="EmptyHintText" Text="Try adjusting your search or filter" 
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontSize="12" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ========== STATUS BAR ========== -->
            <Border Grid.Row="3" Background="#08ffffff" Padding="16,12">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="FileCountText" Text="0 items" 
                                   Foreground="{StaticResource TextMutedBrush}" FontSize="12"/>
                        <TextBlock Text=" â€¢ " Foreground="{StaticResource TextMutedBrush}" FontSize="12"/>
                        <TextBlock x:Name="TotalSizeText" Text="0 B" 
                                   Foreground="{StaticResource TextMutedBrush}" FontSize="12"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Open in Explorer" Style="{StaticResource SecondaryButtonStyle}"
                                Padding="12,6" FontSize="12" Margin="0,0,8,0"
                                Click="OpenInExplorer_Click"/>
                        <Button x:Name="ShareButton" Content="Create Share Link" 
                                Style="{StaticResource PrimaryButtonStyle}"
                                Padding="12,6" FontSize="12"
                                IsEnabled="False"
                                Click="ShareButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
