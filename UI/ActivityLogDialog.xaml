<Window x:Class="Swarm.UI.ActivityLogDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Activity Log" 
        Height="600" Width="800"
        MinHeight="400" MinWidth="600"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    
    <Border Background="{StaticResource BackgroundDarkBrush}" 
            CornerRadius="12" 
            BorderBrush="#30FFFFFF" 
            BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ========== TITLE BAR ========== -->
            <Border Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" 
                    CornerRadius="12,12,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                        <!-- Activity Icon -->
                        <Path Data="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"
                              Width="20" Height="20" 
                              Stretch="Uniform"
                              Fill="{StaticResource AccentPrimaryBrush}"
                              VerticalAlignment="Center"/>
                        <TextBlock Text="Activity Log" FontWeight="Bold" FontSize="16" 
                                   Foreground="{StaticResource TextPrimaryBrush}" 
                                   VerticalAlignment="Center" Margin="12,0,0,0"/>
                        <TextBlock x:Name="EntryCountText" Text="" FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}" 
                                   VerticalAlignment="Center" Margin="12,0,0,0"/>
                    </StackPanel>

                    <!-- Close Button -->
                    <Button Content="âœ•" Width="40" Height="32" 
                            HorizontalAlignment="Right" Margin="0,0,8,0"
                            Foreground="#F85149"
                            Background="Transparent" BorderThickness="0"
                            Padding="0" Cursor="Hand"
                            Click="CloseButton_Click"/>
                </Grid>
            </Border>

            <!-- ========== FILTER BAR ========== -->
            <Border Grid.Row="1" Background="{StaticResource BackgroundMediumBrush}" Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Search Box -->
                    <TextBox x:Name="SearchBox" 
                             Style="{StaticResource SettingsTextBoxStyle}"
                             Text="" 
                             Tag="Search activities..."
                             TextChanged="SearchBox_TextChanged"/>
                    
                    <!-- Filter Dropdown -->
                    <ComboBox x:Name="FilterComboBox" Grid.Column="1" 
                              Width="150" Margin="12,0,0,0"
                              Style="{StaticResource SettingsComboBoxStyle}"
                              SelectionChanged="FilterComboBox_SelectionChanged">
                        <ComboBoxItem Content="All Activities" IsSelected="True"/>
                        <ComboBoxItem Content="Files Only"/>
                        <ComboBoxItem Content="Transfers Only"/>
                        <ComboBoxItem Content="Peers Only"/>
                        <ComboBoxItem Content="Errors Only"/>
                        <ComboBoxItem Content="Warnings"/>
                    </ComboBox>
                    
                    <!-- Export Button -->
                    <Button Grid.Column="2" Content="Export" 
                            Style="{StaticResource SecondaryButtonStyle}"
                            Padding="16,8" Margin="12,0,0,0"
                            Click="ExportButton_Click"/>
                </Grid>
            </Border>

            <!-- ========== ACTIVITY LIST ========== -->
            <ListBox x:Name="ActivityListBox" Grid.Row="2" 
                     Background="Transparent" 
                     BorderThickness="0"
                     Padding="8"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     ItemContainerStyle="{StaticResource PeerListBoxItemStyle}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="4,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Severity Indicator -->
                            <Ellipse Width="8" Height="8" VerticalAlignment="Center" Margin="0,0,12,0">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Fill" Value="{StaticResource TextMutedBrush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Severity}" Value="Success">
                                                <Setter Property="Fill" Value="{StaticResource StatusOnlineBrush}"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Severity}" Value="Warning">
                                                <Setter Property="Fill" Value="#fbbf24"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Severity}" Value="Error">
                                                <Setter Property="Fill" Value="{StaticResource AccentDestructiveBrush}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                            
                            <!-- Time -->
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss}'}" 
                                       Foreground="{StaticResource TextMutedBrush}"
                                       FontSize="11" FontFamily="Consolas"
                                       VerticalAlignment="Center"/>
                            
                            <!-- Message -->
                            <StackPanel Grid.Column="2" Margin="8,0">
                                <TextBlock Text="{Binding Message}" 
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="{Binding Details}" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="11"
                                           TextTrimming="CharacterEllipsis"
                                           Visibility="{Binding Details, Converter={StaticResource NullToCollapsedConverter}, FallbackValue=Collapsed}"/>
                            </StackPanel>
                            
                            <!-- Type Badge -->
                            <Border Grid.Column="3" 
                                    Background="#20ffffff" 
                                    CornerRadius="4" 
                                    Padding="8,2"
                                    VerticalAlignment="Center">
                                <TextBlock Text="{Binding TypeDisplay}" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="10"/>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            
            <!-- Empty State -->
            <TextBlock x:Name="EmptyStateText" Grid.Row="2"
                       Text="No activity recorded yet" 
                       Foreground="{StaticResource TextMutedBrush}"
                       FontSize="14"
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Visibility="Collapsed"/>

            <!-- ========== FOOTER ========== -->
            <Border Grid.Row="3" Background="{StaticResource BackgroundMediumBrush}" 
                    CornerRadius="0,0,12,12" Padding="16,12">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Clear Log" 
                                Style="{StaticResource SecondaryButtonStyle}"
                                Padding="16,8"
                                Foreground="{StaticResource AccentDestructiveBrush}"
                                Click="ClearButton_Click"/>
                        <Button Content="Refresh" 
                                Style="{StaticResource SecondaryButtonStyle}"
                                Padding="16,8" Margin="12,0,0,0"
                                Click="RefreshButton_Click"/>
                    </StackPanel>
                    
                    <Button Content="Close" 
                            Style="{StaticResource PrimaryButtonStyle}"
                            Padding="24,8"
                            HorizontalAlignment="Right"
                            Click="CloseButton_Click"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
