<Window x:Class="Swarm.UI.DiffCompareDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Compare Versions" 
        Height="700" Width="1200"
        MinHeight="500" MinWidth="800"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner">

    <Border Background="{StaticResource BackgroundDarkBrush}" 
            CornerRadius="12" 
            BorderBrush="#30FFFFFF" 
            BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ========== TITLE BAR ========== -->
            <Border Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" 
                    CornerRadius="12,12,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                        <Path Data="M12,5C7.58,5,4,7.79,4,11.2C4,13.79,6.19,16.04,9.24,16.76L8,21L12.39,17.55C12.6,17.56,12.8,17.56,13,17.56H12C16.42,17.56,20,14.77,20,11.36C20,7.79,16.42,5,12,5Z"
                              Width="20" Height="20" 
                              Stretch="Uniform"
                              Fill="{StaticResource AccentPrimaryBrush}"
                              VerticalAlignment="Center"/>
                        <TextBlock Text="Compare Versions" FontWeight="Bold" FontSize="16" 
                                   Foreground="{StaticResource TextPrimaryBrush}" 
                                   VerticalAlignment="Center" Margin="12,0,0,0"/>
                    </StackPanel>

                    <!-- Close Button -->
                    <Button Content="âœ•" Width="40" Height="32" 
                            HorizontalAlignment="Right" Margin="0,0,8,0"
                            Foreground="#F85149"
                            Background="Transparent" BorderThickness="0"
                            Padding="0" Cursor="Hand"
                            Click="CloseButton_Click"/>
                </Grid>
            </Border>

            <!-- ========== FILE INFO ========== -->
            <Border Grid.Row="1" Background="{StaticResource BackgroundMediumBrush}" Padding="16,12">
                <StackPanel>
                    <TextBlock x:Name="FilePathText" 
                               FontSize="14" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               TextTrimming="CharacterEllipsis"/>
                    <TextBlock x:Name="VersionInfoText" 
                               FontSize="12" Margin="0,4,0,0"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>
            </Border>

            <!-- ========== DIFF CONTENT ========== -->
            <Grid Grid.Row="2" Margin="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel: Selected Version -->
                <Border Grid.Column="0" Style="{StaticResource CardBorderStyle}" Padding="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <Border Background="#20FFFFFF" Padding="12,8" CornerRadius="16,16,0,0">
                            <TextBlock Text="ðŸ“ Selected Version" 
                                       FontWeight="SemiBold" FontSize="13"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </Border>
                        
                        <ScrollViewer Grid.Row="1" 
                                      HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="VersionDiffPanel" Padding="8">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="50"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding LineNumber}" 
                                                       Foreground="{StaticResource TextMutedBrush}"
                                                       FontFamily="Consolas" FontSize="12"
                                                       TextAlignment="Right" Margin="0,0,12,0"
                                                       VerticalAlignment="Center"/>
                                            <Border Grid.Column="1" 
                                                    Background="{Binding Background}" 
                                                    CornerRadius="4" Padding="8,2" Margin="0,1">
                                                <TextBlock Text="{Binding Text}" 
                                                           Foreground="{Binding Foreground}"
                                                           FontFamily="Consolas" FontSize="12"
                                                           TextWrapping="NoWrap"/>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Right Panel: Current File -->
                <Border Grid.Column="2" Style="{StaticResource CardBorderStyle}" Padding="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <Border Background="#20FFFFFF" Padding="12,8" CornerRadius="16,16,0,0">
                            <TextBlock Text="ðŸ“„ Current File" 
                                       FontWeight="SemiBold" FontSize="13"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </Border>
                        
                        <ScrollViewer Grid.Row="1" 
                                      HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="CurrentDiffPanel" Padding="8">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="50"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding LineNumber}" 
                                                       Foreground="{StaticResource TextMutedBrush}"
                                                       FontFamily="Consolas" FontSize="12"
                                                       TextAlignment="Right" Margin="0,0,12,0"
                                                       VerticalAlignment="Center"/>
                                            <Border Grid.Column="1" 
                                                    Background="{Binding Background}" 
                                                    CornerRadius="4" Padding="8,2" Margin="0,1">
                                                <TextBlock Text="{Binding Text}" 
                                                           Foreground="{Binding Foreground}"
                                                           FontFamily="Consolas" FontSize="12"
                                                           TextWrapping="NoWrap"/>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>

            <!-- ========== LEGEND ========== -->
            <Border Grid.Row="3" Background="{StaticResource BackgroundMediumBrush}" 
                    CornerRadius="0,0,12,12" Padding="16,12">
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                        <Border Background="#2234d399" CornerRadius="4" Padding="8,4" Margin="0,0,16,0">
                            <TextBlock Text="+ Added" Foreground="#34d399" FontSize="12" FontWeight="SemiBold"/>
                        </Border>
                        <Border Background="#22ef4444" CornerRadius="4" Padding="8,4" Margin="0,0,16,0">
                            <TextBlock Text="âˆ’ Removed" Foreground="#ef4444" FontSize="12" FontWeight="SemiBold"/>
                        </Border>
                        <Border Background="#22a1a1aa" CornerRadius="4" Padding="8,4">
                            <TextBlock Text="~ Modified" Foreground="#a1a1aa" FontSize="12" FontWeight="SemiBold"/>
                        </Border>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Close" 
                                Style="{StaticResource SecondaryButtonStyle}"
                                Padding="24,8"
                                Click="CloseButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
